# 媒体分卷压缩 / MediaMultipartZip

<b>你是否在上传大量文件的时候遇到过 大量文件 被打成 分卷压缩 包,<br/>
只有 下载全部 压缩包之后才能解压？</b>

Have you ever encountered a large number of files being compressed into sub-volumes when uploading a large number of files,<br/>
Only after downloading all the compressed files can they be decompressed?<br/>

<b>不！我只想要某个压缩包的内容！我不想下载全部压缩包！<br/></b>

No! I just want the contents in a certain zip! I don't want to download all the zip files!

## 运作机制 / How it works

<b>由于媒体文件，如 MP4, JPEG 等常见影音文件已经被压缩过，在打压缩包的时候使用压缩算法也并不能进一步减少太多体积。<br/>
而常规分卷压缩 对于几乎不可压缩的媒体文件 显然是一种十分反人类的压缩方式。<br/>
因此这里我计划将文件按照设定的上限值，根据尺寸尽可能将文件紧凑的塞入多个压缩包中 (不是分卷)，<br/>
从而能让你在需要具体某个文件的时候，可以只下载其中某个具体的压缩包，解压，得到文件。<br/></b>

&nbsp; Since media files, such as MP4, JPEG and other common audio-visual files, have already been compressed,<br/>
using a compression algorithm when compressing the package cannot further reduce the volume too much.<br/>
&nbsp; However, conventional sub-volume compression is obviously a very anti-human compression method for almost incompressible media files.<br/>
&nbsp; Therefore, here we plan to pack the files into multiple compressed packages (not divided into volumes)<br/>
as compactly as possible according to the set upper limit.<br/>
&nbsp; So that when you need a specific file, you can only download a specific compressed package, decompress it, and get the file.<br/>

<b>而媒体文件相比于其它类型文件，具有视觉上的可压缩性，我的想法是：<br/>
---- 使用案例 ----<br/>
假设有 100 GB 的视频/图片文件要进行压缩，<br/>
---- 生成预览 ----<br/>
其中某个视频可能为 2GB，1080p，10Mbps 的码率，<br/>
你可以将视频编码成一个 100MB, 480p, 0.2Mbps 的低清预览。(如 Media Encoder / FFMPEG)<br/>
此时可以把所有的预览放在一个压缩包内，作为一个 “目录” 来检索你想要下载的内容。<br/>
预览文件的尺寸应该很小，通常 100 GB 的 10Mbps 在压缩到 480p 后只有 2GB 左右。<br/>
---- 创建分卷 ----<br/>
假设你想要 4GB 作为一个压缩分卷，<br/>
程序会把如 2GB + 1GB + 0.5GB + 0.5GB 的文件放入一个压缩包内来创建 4GB 的 zip 文件。<br/>
---- 获得索引 ----<br/>
在这个过程中，会生成一个 XML 文档，来指示每个文件被放入了哪个压缩包内。<br/>
---- 上传文件 ----<br/>
随后就可以把 XML 文件和预览一起打包为 "预览.zip" 并上传，<br/>
再把程序生成的 "01.zip" "02.zip" "03.zip" ..... "25.zip" 也上传到云端<br/>
---- 查找文件 ----<br/>
想从服务器下载某个文件时，先下载 "预览.zip" 文件，<br/>
在 "预览.zip" 中找到你想下载的文件，如 "Test.mp4"，<br/>
---- 文件定位 ----<br/>
在对应的 XML 文件中，根据路径找到文件所在的压缩包编号，<br/>
如 ID = 3，则表示文件位于 "03.zip" 中。<br/>
---- 取回文件 ----<br/>
此时你只需要下载 "03.zip" 便可取回 "Test.mp4" 文件。</b>

Compared with other types of files, media files are visually compressible. <br/>
My thoughts are:<br/>
---- Use Cases ----<br/>
&nbsp; Suppose there are 100 GB video/picture files to be compressed,<br/>
---- Build Preview ----<br/>
&nbsp; One of the videos may be 2GB, 1080p, 10Mbps bitrate,<br/>
&nbsp; You can encode the video to a 100MB, 480p, 0.2Mbps low-res preview. (like Media Encoder / FFMPEG)<br/>
&nbsp; At this point, you can put all the previews in a compressed package, <br/>
as a "directory" to retrieve the content you want to download.<br/>
&nbsp; The preview file size should be small, typically 100 GB at 10Mbps is only around 2GB when compressed to 480p.<br/>
---- Create sub-volume ----<br/>
&nbsp; Suppose you want 4GB as a compressed volume,<br/>
&nbsp; The program will put files like 2GB + 1GB + 0.5GB + 0.5GB into a compressed package to create a 4GB zip file.<br/>
---- get index ----<br/>
&nbsp; During this process, an XML document is generated indicating which tarball each file was placed into.<br/>
---- upload files ----<br/>
&nbsp; The XML file and the preview can then be packaged together as a "preview.zip" and uploaded,<br/>
&nbsp; Then upload the "01.zip" "02.zip" "03.zip" ..... "25.zip" generated by the program to the cloud<br/>
---- Find files ----<br/>
&nbsp; When you want to download a file from the server, first download the "preview.zip" file,<br/>
&nbsp; Find the file you want to download in "Preview.zip", such as "Test.mp4",<br/>
---- File location ----<br/>
&nbsp; In the corresponding XML file, find the compressed package number where the file is located according to the path,<br/>
&nbsp; If ID = 3, the file is located in "03.zip".<br/>
---- Retrieve files ----<br/>
&nbsp; At this point you only need to download "03.zip" to get back the "Test.mp4" file.
